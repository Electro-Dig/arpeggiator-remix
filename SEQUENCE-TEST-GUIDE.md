# 🎵 序列测试指南 - Minimal Groove

## 🎯 测试目标

验证Minimal Groove预设的完整8拍序列功能，确保：
- 手势识别正确提供根音
- 琶音播放保持完整的8拍循环结构
- 空拍处理正确（降低音量但继续琶音）

## 📋 测试步骤

### 1. 基础功能测试

**操作：**
1. 打开应用，等待摄像头初始化
2. 选择"Minimal Groove"预设
3. 伸出左手，观察Pitch显示

**验证：**
- ✅ Pitch显示根据手部位置实时变化
- ✅ 显示的根音准确（C4, D4, E4, F4, G4, A4, B4, C5）

### 2. 序列播放测试

**操作：**
1. 将左手置于E4位置（大约屏幕中下方）
2. 保持手部稳定，听取琶音播放

**验证：**
- ✅ 播放8拍循环序列：[E4, G4, 空拍, B4, C5, 空拍, B4, 空拍]
- ✅ 空拍时音量降低但琶音不停止
- ✅ 循环播放，保持minimalist groove特性

### 3. 根音变换测试

**操作：**
1. 缓慢移动左手从E4位置到A4位置（向上移动）
2. 观察琶音序列的变化

**验证：**
- ✅ A4位置播放：[A4, C5, 空拍, E5, F5, 空拍, E5, 空拍]
- ✅ 序列结构保持不变，只是音高移调
- ✅ 过渡平滑，无音频断裂

### 4. 全音域测试

**测试各个位置的序列：**

| 根音 | 预期8拍序列 |
|------|-------------|
| C4 | [C4, D#4, 空拍, G4, G#4, 空拍, G4, 空拍] |
| D4 | [D4, F4, 空拍, A4, A#4, 空拍, A4, 空拍] |
| E4 | [E4, G4, 空拍, B4, C5, 空拍, B4, 空拍] |
| F4 | [F4, G#4, 空拍, C5, C#5, 空拍, C5, 空拍] |
| G4 | [G4, A#4, 空拍, D5, D#5, 空拍, D5, 空拍] |
| A4 | [A4, C5, 空拍, E5, F5, 空拍, E5, 空拍] |
| B4 | [B4, D5, 空拍, F#5, G5, 空拍, F#5, 空拍] |
| C5 | [C5, D#5, 空拍, G5, G#5, 空拍, G5, 空拍] |

### 5. 空拍处理验证

**操作：**
1. 选择任意根音位置
2. 仔细听取第3拍、第6拍、第8拍（空拍位置）

**验证：**
- ✅ 空拍时音量明显降低
- ✅ 琶音循环不中断
- ✅ 空拍后正常音符恢复正常音量

## 🔧 故障排除

### 问题1：琶音不播放
**可能原因：**
- 音频上下文未激活
- 手部检测失败

**解决方案：**
- 点击"Click to enable audio"
- 确保手部在摄像头视野内

### 问题2：序列不完整
**可能原因：**
- 预设加载失败
- 序列定义错误

**解决方案：**
- 重新选择Minimal Groove预设
- 检查控制台错误信息

### 问题3：空拍处理异常
**可能原因：**
- 音量控制逻辑错误
- null值处理异常

**解决方案：**
- 检查MusicManager.js中的空拍处理逻辑
- 验证序列定义中的null值

## 📊 性能指标

**正常指标：**
- 琶音延迟：< 50ms
- 根音切换响应：< 100ms
- CPU使用率：< 30%
- 内存使用：稳定，无泄漏

**异常指标：**
- 琶音延迟：> 200ms
- 根音切换响应：> 500ms
- CPU使用率：> 50%
- 内存使用：持续增长

## 🎵 技术验证

**在浏览器控制台中验证：**

```javascript
// 检查当前预设
console.log(game.musicManager.getCurrentMusicPreset());

// 应该显示：
// {
//   name: "Minimal Groove",
//   sequence: [0, 3, null, 7, 8, null, 7, null],
//   arpeggioPattern: "up",
//   tempo: 122,
//   synthPreset: 2
// }

// 检查活动琶音
console.log(game.musicManager.activePatterns);

// 检查序列转换
// 如果根音是E4，序列应该转换为：
// [E4, G4, null, B4, C5, null, B4, null]
```

---

**测试完成标准：**
- ✅ 所有8个根音位置都能正常播放对应序列
- ✅ 空拍处理正确，音量降低但不中断
- ✅ 琶音循环播放稳定，保持minimalist特性
- ✅ 性能指标正常，无明显延迟

**最后更新：** 2024-01-XX 