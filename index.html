<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Arpeggiator</title>
        <link rel="stylesheet" href="styles.css">

        <!-- Primary Meta Tags -->
        <meta name="title" content="Arpeggiator">
        <meta name="description" content="hand-controlled arp, drum machine, real-time visualizer">

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://collidingscopes.github.io/arpeggiator/">
        <meta property="og:title" content="Arpeggiator">
        <meta property="og:description" content="hand-controlled arp, drum machine, real-time visualizer">
        <meta property="og:image" content="https://raw.githubusercontent.com/collidingScopes/arpeggiator/main/assets/siteOGImage.webp">

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://collidingscopes.github.io/arpeggiator/">
        <meta property="twitter:title" content="Arpeggiator">
        <meta property="twitter:description" content="hand-controlled arp, drum machine, real-time visualizer">
        <meta property="twitter:image" content="https://raw.githubusercontent.com/collidingScopes/arpeggiator/main/assets/siteOGImage.webp">

        <script defer src="https://cloud.umami.is/script.js" data-website-id="eb59c81c-27cb-4e1d-9e8c-bfbe70c48cd9"></script>
        <script type="importmap">
            {
                "imports": {
                    "three": "https://esm.sh/three@0.161.0?dev",
                    "three/": "https://esm.sh/three@0.161.0&dev/"
                }
            }
        </script>
    </head>
    <body style="width: 100%; height: 100%; overflow: hidden; margin: 0;">
        <div id="renderDiv" style="width: 100%; height: 100%; margin: 0;">

            <!-- ä¸»è¦çŠ¶æ€ä¿¡æ¯ -->
            <div id="info-text">raise your hands to raise the roof</div>
            
            <!-- å½“å‰é¢„è®¾ä¿¡æ¯æ˜¾ç¤º -->
            <div id="preset-info">
                <div id="music-preset">éŸ³ä¹: C Minor Pentatonic</div>
                <div id="drum-preset">é¼“ç»„: Hip Hop</div>
                <div class="gesture-hint">
                    å³æ‰‹: å…¨éƒ¨å¼ å¼€åˆ‡æ¢éŸ³ä¹ | æ¡æ‹³åˆ‡æ¢é¼“ç»„
                </div>
            </div>

        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div id="control-panel">
            <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
            <div class="quick-controls">
                <button id="open-arpeggio-editor" class="control-btn">
                    <span class="btn-icon">ğŸ¹</span>
                    <span class="btn-text">ç¶éŸ³ç¼–è¾‘</span>
                </button>
                <button id="open-drum-editor" class="control-btn">
                    <span class="btn-icon">ğŸ¥</span>
                    <span class="btn-text">é¼“ç»„ç¼–è¾‘</span>
                </button>
                <button id="toggle-help" class="control-btn">
                    <span class="btn-icon">â“</span>
                    <span class="btn-text">å¸®åŠ©</span>
                </button>
            </div>

            <!-- é¢„è®¾é€‰æ‹©å™¨ -->
            <div class="preset-controls">
                <div class="preset-group">
                    <label>éŸ³ä¹é¢„è®¾</label>
                    <select id="music-preset-select">
                        <option value="0">C Minor Pentatonic</option>
                        <option value="1">G Major Pentatonic</option>
                        <option value="2">E Minor Blues</option>
                        <option value="3">A Dorian Mode</option>
                        <option value="4">Japanese Pentatonic</option>
                    </select>
                </div>
                <div class="preset-group">
                    <label>é¼“ç»„é¢„è®¾</label>
                    <select id="drum-preset-select">
                        <option value="0">Hip Hop</option>
                        <option value="1">House</option>
                        <option value="2">Techno</option>
                        <option value="3">Funk</option>
                        <option value="4">Reggae</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- å¸®åŠ©é¢æ¿ -->
        <div id="help-panel" class="hidden">
            <div class="help-content">
                <h3>ğŸ® æ“ä½œæŒ‡å—</h3>
                <div class="help-section">
                    <h4>ğŸ¤š å·¦æ‰‹æ§åˆ¶ (ç¶éŸ³)</h4>
                    <ul>
                        <li>ä¸Šä¸‹ç§»åŠ¨ï¼šæ§åˆ¶éŸ³é«˜</li>
                        <li>æ‹‡æŒ‡é£ŸæŒ‡è·ç¦»ï¼šæ§åˆ¶éŸ³é‡</li>
                        <li>æ¡æ‹³ï¼šåˆ‡æ¢éŸ³è‰²</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h4>ğŸ¤š å³æ‰‹æ§åˆ¶ (é¼“ç»„)</h4>
                    <ul>
                        <li>é£ŸæŒ‡ï¼šKick é¼“</li>
                        <li>ä¸­æŒ‡ï¼šSnare é¼“</li>
                        <li>æ— åæŒ‡ï¼šHi-hat</li>
                        <li>å°æŒ‡ï¼šClap</li>
                        <li>å…¨éƒ¨å¼ å¼€ï¼šåˆ‡æ¢éŸ³ä¹é¢„è®¾</li>
                        <li>æ¡æ‹³ï¼šåˆ‡æ¢é¼“ç»„é¢„è®¾</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ç¶éŸ³ç¼–è¾‘å™¨å¼¹çª— -->
        <div id="arpeggio-editor-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ğŸ¹ ç¶éŸ³ç¼–è¾‘å™¨</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <!-- é¢„è®¾é€‰æ‹© -->
                    <div class="editor-section">
                        <h3>é€‰æ‹©åŸºç¡€é¢„è®¾</h3>
                        <select id="arpeggio-base-preset">
                            <option value="0">C Minor Pentatonic</option>
                            <option value="1">G Major Pentatonic</option>
                            <option value="2">E Minor Blues</option>
                            <option value="3">A Dorian Mode</option>
                            <option value="4">Japanese Pentatonic</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
                        </select>
                    </div>

                    <!-- éŸ³é˜¶ç¼–è¾‘ -->
                    <div class="editor-section">
                        <h3>éŸ³é˜¶è®¾ç½®</h3>
                        <div class="note-grid">
                            <!-- éŸ³ç¬¦é€‰æ‹©å™¨å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- å’Œå¼¦é—´éš”ç¼–è¾‘ -->
                    <div class="editor-section">
                        <h3>å’Œå¼¦é—´éš”</h3>
                        <div class="interval-inputs">
                            <input type="number" class="interval-input" placeholder="0" min="0" max="24">
                            <input type="number" class="interval-input" placeholder="3" min="0" max="24">
                            <input type="number" class="interval-input" placeholder="5" min="0" max="24">
                            <input type="number" class="interval-input" placeholder="7" min="0" max="24">
                            <input type="number" class="interval-input" placeholder="10" min="0" max="24">
                            <input type="number" class="interval-input" placeholder="12" min="0" max="24">
                        </div>
                    </div>

                    <!-- ç¶éŸ³æ¨¡å¼ -->
                    <div class="editor-section">
                        <h3>ç¶éŸ³æ¨¡å¼</h3>
                        <div class="pattern-selector">
                            <label><input type="radio" name="arpeggio-pattern" value="up"> ä¸Šè¡Œ</label>
                            <label><input type="radio" name="arpeggio-pattern" value="down"> ä¸‹è¡Œ</label>
                            <label><input type="radio" name="arpeggio-pattern" value="upDown" checked> ä¸Šä¸‹å¾ªç¯</label>
                        </div>
                    </div>

                    <!-- é€Ÿåº¦æ§åˆ¶ -->
                    <div class="editor-section">
                        <h3>é€Ÿåº¦ (BPM)</h3>
                        <input type="range" id="arpeggio-tempo" min="60" max="180" value="100">
                        <span id="tempo-value">100</span>
                    </div>

                    <!-- é¢„è§ˆå’Œä¿å­˜ -->
                    <div class="editor-actions">
                        <button id="preview-arpeggio" class="action-btn preview-btn">ğŸ”Š é¢„è§ˆ</button>
                        <button id="save-arpeggio" class="action-btn save-btn">ğŸ’¾ ä¿å­˜é¢„è®¾</button>
                        <button id="apply-arpeggio" class="action-btn apply-btn">âœ… åº”ç”¨</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¼“ç»„ç¼–è¾‘å™¨å¼¹çª— -->
        <div id="drum-editor-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ğŸ¥ é¼“ç»„ç¼–è¾‘å™¨</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <!-- é¢„è®¾é€‰æ‹© -->
                    <div class="editor-section">
                        <h3>é€‰æ‹©åŸºç¡€é¢„è®¾</h3>
                        <select id="drum-base-preset">
                            <option value="0">Hip Hop</option>
                            <option value="1">House</option>
                            <option value="2">Techno</option>
                            <option value="3">Funk</option>
                            <option value="4">Reggae</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
                        </select>
                    </div>

                    <!-- 16æ­¥éŸ³åºå™¨ -->
                    <div class="editor-section">
                        <h3>éŸ³åºå™¨æ¨¡å¼</h3>
                        <div class="sequencer">
                            <!-- Kick -->
                            <div class="drum-row">
                                <div class="drum-label">Kick ğŸ¥</div>
                                <div class="step-row" data-drum="kick">
                                    <!-- 16ä¸ªæ­¥éª¤å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                                </div>
                            </div>
                            
                            <!-- Snare -->
                            <div class="drum-row">
                                <div class="drum-label">Snare ğŸ¥¢</div>
                                <div class="step-row" data-drum="snare">
                                    <!-- 16ä¸ªæ­¥éª¤å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                                </div>
                            </div>
                            
                            <!-- Hi-hat -->
                            <div class="drum-row">
                                <div class="drum-label">Hi-hat ğŸ©</div>
                                <div class="step-row" data-drum="hihat">
                                    <!-- 16ä¸ªæ­¥éª¤å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                                </div>
                            </div>
                            
                            <!-- Clap -->
                            <div class="drum-row">
                                <div class="drum-label">Clap ğŸ‘</div>
                                <div class="step-row" data-drum="clap">
                                    <!-- 16ä¸ªæ­¥éª¤å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ’­æ”¾ä½ç½®æŒ‡ç¤ºå™¨ -->
                        <div class="playhead" id="drum-playhead"></div>
                    </div>

                    <!-- å¿«é€Ÿæ“ä½œ -->
                    <div class="editor-section">
                        <h3>å¿«é€Ÿæ“ä½œ</h3>
                        <div class="quick-actions">
                            <button class="quick-btn" onclick="clearAllDrums()">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
                            <button class="quick-btn" onclick="randomizeDrums()">ğŸ² éšæœºç”Ÿæˆ</button>
                            <button class="quick-btn" onclick="copyPattern()">ğŸ“‹ å¤åˆ¶æ¨¡å¼</button>
                            <button class="quick-btn" onclick="pastePattern()">ğŸ“ ç²˜è´´æ¨¡å¼</button>
                        </div>
                    </div>

                    <!-- é¢„è§ˆå’Œä¿å­˜ -->
                    <div class="editor-actions">
                        <button id="preview-drum" class="action-btn preview-btn">ğŸ”Š é¢„è§ˆ</button>
                        <button id="save-drum" class="action-btn save-btn">ğŸ’¾ ä¿å­˜é¢„è®¾</button>
                        <button id="apply-drum" class="action-btn apply-btn">âœ… åº”ç”¨</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¿å­˜é¢„è®¾å¼¹çª— -->
        <div id="save-preset-modal" class="modal">
            <div class="modal-content small">
                <div class="modal-header">
                    <h2>ğŸ’¾ ä¿å­˜é¢„è®¾</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <input type="text" id="preset-name" placeholder="è¾“å…¥é¢„è®¾åç§°..." maxlength="20">
                    <div class="modal-actions">
                        <button id="confirm-save" class="action-btn save-btn">ä¿å­˜</button>
                        <button id="cancel-save" class="action-btn cancel-btn">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            // å…¨å±€åŠŸèƒ½å‡½æ•°
            function toggleHelp() {
                const helpPanel = document.getElementById('help-panel');
                helpPanel.classList.toggle('hidden');
            }
            
            // æ›´æ–°å¸®åŠ©æŒ‰é’®äº‹ä»¶ç›‘å¬
            document.addEventListener('DOMContentLoaded', function() {
                const helpBtn = document.getElementById('toggle-help');
                if (helpBtn) {
                    helpBtn.addEventListener('click', toggleHelp);
                }
            });
        </script>
        
        <script type="module" src="main.js"></script>
    </body>
</html>